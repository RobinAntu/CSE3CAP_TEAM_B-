import{g as e}from"./index-76c07c6a.js";const t=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function n(e){const[t,n]=e.split(":").map(Number);return 60*t+n}function s(e){return`${String(Math.floor(e/60)).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}function r(e,t,n){const s=[];for(let r=e;r<t;r+=n)s.push(r);return s}function o(e,t){return n(e.start)<n(t.end)&&n(t.start)<n(e.end)}function u(e,t,n){return{day:e,start:t,end:n}}function i(e,t,s){const{prefs:r,nowISO:u,daySchedule:i}=s,a=function(e,t){if(!e.assessments||0===e.assessments.length)return 0;const n=new Date(t),s=e.assessments.map(e=>(new Date(e.deadlineISO)-n)/864e5),r=Math.min(...s);return Math.max(0,Math.min(1,1-r/14))}(t,u),c=function(e,t){const s=Math.floor(n(e.start)/60);return s>=7&&s<12?t.preferredTimes.morning?1:.5:s>=12&&s<17?t.preferredTimes.afternoon?1:.5:s>=17&&s<22&&t.preferredTimes.evening?1:0}(e,r),f=function(e){let t=(e.weeklyTargetHours||0)/6;return e.assessments&&e.assessments.some(e=>"high"===e.priority)&&(t+=.2),Math.min(1,t)}(t),d=function(e,t){let s=n(e.end)>n("20:30")?1:0;return t.some(t=>o(t,e)||t.end===e.start)&&(s+=.5),s}(e,i);return 3*a+2*c+2*f-1*d}function a({courses:e,fixedEvents:t,prefs:n,weekConfig:u}){const a=function(e,t,n){const u=[];for(const i of e.days){const a=t.filter(e=>e.day===i),c=60*e.startHour,f=60*e.endHour;for(const e of r(c,f-n,n)){const t={day:i,start:s(e),end:s(e+n)};a.some(e=>o(e,t))||u.push(t)}}return u}(u,t,n.sessionMinutes),c=[],f=(new Date).toISOString();for(const s of a)for(const t of e){if(t._remaining<=0)continue;const e=i(s,t,{prefs:n,nowISO:f,daySchedule:[]});c.push({score:e,slot:s,courseId:t.id})}return c.sort((e,t)=>t.score-e.score)}function c({courses:e,fixedEvents:t,prefs:n,weekConfig:s}){const r=Object.fromEntries(e.map(e=>[e.id,{...e,_remaining:e.weeklyTargetHours||0}])),u=function(e,t){const{prefs:n,courseMap:s}=t,r=[],u={Mon:[],Tue:[],Wed:[],Thu:[],Fri:[],Sat:[],Sun:[]},i={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0};for(const a of e){const{slot:e,courseId:t}=a,c=e.day,f=s[t];f._remaining<=0||i[c]+n.sessionMinutes/60>n.dailyMaxHours||u[c].some(t=>o(t,e))||(r.push({slot:e,courseId:t}),u[c].push(e),i[c]+=n.sessionMinutes/60,f._remaining-=n.sessionMinutes/60)}return{schedule:r,usedByDay:u,dailyTotals:i}}(a({courses:Object.values(r),fixedEvents:t,prefs:n,weekConfig:s}),{prefs:n,weekConfig:s,courseMap:r});return function(e,t){return e.schedule.map(({slot:e,courseId:n})=>{const s=t[n];return{id:crypto.randomUUID(),title:`Study: ${s.code}`,day:e.day,start:e.start,end:e.end,courseId:n,color:s.color||"#3b82f6"}})}(u,r)}function f(){const{courses:n,events:s,prefs:r,setEvents:o}=e();return{generateSchedule:function({replace:e=!0}={}){const i=function(e){const t=[];return e.courses.forEach(e=>{(e.fixedSlots||[]).forEach(e=>t.push(u(e.day,e.start,e.end)))}),(e.events||[]).forEach(e=>{e.title.startsWith("Study: ")||t.push(u(e.day,e.start,e.end))}),t}({courses:n,events:s}),a=function(e){return{days:t,startHour:e.workingHours.start,endHour:e.workingHours.end}}(r),f=c({courses:n,fixedEvents:i,prefs:r,weekConfig:a});return o(t=>[...e?t.filter(e=>!e.title.startsWith("Study: ")):t,...f]),f.length}}}export{f as u};
