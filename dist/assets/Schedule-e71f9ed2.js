import{r as e,j as s,I as t,i as l,g as n}from"./index-76c07c6a.js";import{B as a}from"./Button-062e88f2.js";import{w as c,a as i,f as r,b as o,t as d}from"./time-f6c7f5b8.js";function u({subjects:n,onAdd:c,onEdit:i,onDelete:r,onExportCSV:o,onExportICS:d,filter:u,setFilter:x,onSelect:h}){const[m,j]=e.useState(""),v=n.filter(e=>("all"===u||("active"===u?e.active:!e.active))&&(e.code.toLowerCase().includes(m.toLowerCase())||e.title.toLowerCase().includes(m.toLowerCase())));return s.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 flex flex-col",children:[s.jsxs("div",{className:"p-4 border-b",children:[s.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Subjects"}),s.jsx(t,{placeholder:"Search subjects...",value:m,onChange:e=>j(e.target.value),className:"w-full"})]}),s.jsx("div",{className:"p-4",children:s.jsx("div",{className:"flex bg-gray-100 rounded-md p-1",children:[{k:"all",label:"All"},{k:"active",label:"Active"},{k:"inactive",label:"Inactive"}].map(e=>s.jsx("button",{onClick:()=>x(e.k),className:"w-full text-center text-sm py-1.5 rounded-md transition-colors "+(u===e.k?"bg-white shadow-sm text-gray-800 font-medium":"text-gray-500 hover:bg-gray-200"),children:e.label},e.k))})}),s.jsx("div",{className:"flex-1 overflow-y-auto border-t",children:v.length>0?s.jsx("ul",{className:"divide-y",children:v.map(e=>s.jsxs("li",{onClick:()=>h(e.id),className:"p-4 cursor-pointer hover:bg-gray-50 group relative",children:[s.jsx("div",{className:"font-semibold text-gray-800",children:e.code}),s.jsx("div",{className:"text-sm text-gray-500",children:e.title}),s.jsxs("div",{className:"absolute top-2 right-2 flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.jsx(l,{size:"sm","aria-label":"edit subject",onClick:s=>{s.stopPropagation(),i(e)},children:s.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),s.jsx(l,{size:"sm","aria-label":"delete subject",onClick:s=>{s.stopPropagation(),r(e.id)},children:s.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id))}):s.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No subjects found."})}),s.jsxs("div",{className:"p-4 border-t space-y-2",children:[s.jsx(a,{onClick:c,className:"w-full",children:"Add Subject"}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsx(a,{onClick:o,variant:"outline",children:"Export CSV"}),s.jsx(a,{onClick:d,variant:"outline",children:"Export ICS"})]})]})]})}function x({week:e,onPrev:t,onNext:l,onToday:n,subjectFilter:o,setSubjectFilter:d,kindFilter:u,setKindFilter:x,timeFilter:h,setTimeFilter:m,subjectOptions:j=[]}){const v=c(e),p=i(v,6),b=`${r(v,"MMM d")} - ${r(p,"MMM d")}`;return s.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(a,{onClick:t,children:"‹"}),s.jsx(a,{onClick:n,children:"Today"}),s.jsx(a,{onClick:l,children:"›"}),s.jsx("div",{className:"ml-4 font-semibold",children:b})]}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[s.jsx("select",{multiple:!0,value:o,onChange:e=>d(Array.from(e.target.selectedOptions).map(e=>e.value)),className:"border rounded p-1",children:j.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsxs("label",{className:"flex items-center space-x-1",children:[s.jsx("input",{type:"checkbox",checked:u.class,onChange:e=>x({...u,class:e.target.checked})}),s.jsx("span",{children:"Class"})]}),s.jsxs("label",{className:"flex items-center space-x-1",children:[s.jsx("input",{type:"checkbox",checked:u.study,onChange:e=>x({...u,study:e.target.checked})}),s.jsx("span",{children:"Study"})]}),s.jsxs("label",{className:"flex items-center space-x-1",children:[s.jsx("input",{type:"checkbox",checked:h.morning,onChange:e=>m({...h,morning:e.target.checked})}),s.jsx("span",{children:"Morning"})]}),s.jsxs("label",{className:"flex items-center space-x-1",children:[s.jsx("input",{type:"checkbox",checked:h.afternoon,onChange:e=>m({...h,afternoon:e.target.checked})}),s.jsx("span",{children:"Afternoon"})]}),s.jsxs("label",{className:"flex items-center space-x-1",children:[s.jsx("input",{type:"checkbox",checked:h.evening,onChange:e=>m({...h,evening:e.target.checked})}),s.jsx("span",{children:"Evening"})]}),s.jsx(a,{onClick:()=>window.print(),className:"ml-2",children:"Print"})]})]})}function h({event:e,subject:t,style:l}){var n;const a=(null==t?void 0:t.color)||"#3b82f6",c="study"===e.kind||(null==(n=e.title)?void 0:n.startsWith("Study:"));return s.jsx("div",{className:"absolute px-1 py-0.5 text-xs rounded overflow-hidden "+(c?"text-white":"border"),style:{backgroundColor:c?a:"white",borderColor:a,color:c?"white":"black",left:2,right:2,...l},children:c?`Study: ${(null==t?void 0:t.code)||""}`:`Class: ${(null==t?void 0:t.code)||""}`})}function m({events:e,subjects:t}){return s.jsx("div",{className:"grid grid-cols-7 h-[900px] relative",children:o.map((l,n)=>s.jsx("div",{className:"border-r border-b relative",children:e.filter(e=>e.day===l).map(e=>{const l=(d(e.start)-420)/900*100,n=(d(e.end)-d(e.start))/900*100,a=t.find(s=>s.id===e.courseId);return s.jsx(h,{event:e,subject:a,style:{top:`${l}%`,height:`${n}%`}},e.id)})},l))})}function j({subjects:l,onSave:n,onClose:c,initial:i}){var r;const[o,d]=e.useState(i||{subjectId:(null==(r=l[0])?void 0:r.id)||"",kind:"study",day:"Mon",start:"09:00",end:"10:00"});function u(e,s){d({...o,[e]:s})}return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",role:"dialog","aria-modal":"true",children:s.jsxs("div",{className:"bg-white p-4 rounded w-80 space-y-2",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Session"}),s.jsxs("label",{className:"block text-sm",children:["Subject",s.jsx("select",{value:o.subjectId,onChange:e=>u("subjectId",e.target.value),className:"w-full border rounded p-1",children:l.map(e=>s.jsx("option",{value:e.id,children:e.code},e.id))})]}),s.jsxs("label",{className:"block text-sm",children:["Kind",s.jsxs("select",{value:o.kind,onChange:e=>u("kind",e.target.value),className:"w-full border rounded p-1",children:[s.jsx("option",{value:"class",children:"Class"}),s.jsx("option",{value:"study",children:"Study"})]})]}),s.jsxs("label",{className:"block text-sm",children:["Day",s.jsx("select",{value:o.day,onChange:e=>u("day",e.target.value),className:"w-full border rounded p-1",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(e=>s.jsx("option",{value:e,children:e},e))})]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsxs("label",{className:"block text-sm flex-1",children:["Start",s.jsx(t,{type:"time",value:o.start,onChange:e=>u("start",e.target.value)})]}),s.jsxs("label",{className:"block text-sm flex-1",children:["End",s.jsx(t,{type:"time",value:o.end,onChange:e=>u("end",e.target.value)})]})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[s.jsx(a,{onClick:c,type:"button",variant:"secondary",children:"Cancel"}),s.jsx(a,{onClick:function(){n(o)},type:"button",children:"Save"})]})]})})}function v({onSave:l,onClose:n,initial:c}){const[i,r]=e.useState(c||{code:"",title:"",instructor:"",color:"#3b82f6",active:!0,weeklyTargetHours:3});function o(e,s){r({...i,[e]:s})}return s.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",role:"dialog","aria-modal":"true",children:s.jsxs("div",{className:"bg-white p-4 rounded w-80 space-y-2",children:[s.jsx("h2",{className:"text-lg font-semibold",children:"Subject"}),s.jsxs("label",{className:"block text-sm",children:["Code",s.jsx(t,{value:i.code,onChange:e=>o("code",e.target.value)})]}),s.jsxs("label",{className:"block text-sm",children:["Title",s.jsx(t,{value:i.title,onChange:e=>o("title",e.target.value)})]}),s.jsxs("label",{className:"block text-sm",children:["Instructor",s.jsx(t,{value:i.instructor,onChange:e=>o("instructor",e.target.value)})]}),s.jsxs("label",{className:"block text-sm",children:["Color",s.jsx(t,{type:"color",value:i.color,onChange:e=>o("color",e.target.value)})]}),s.jsxs("label",{className:"block text-sm",children:["Weekly Target Hours",s.jsx(t,{type:"number",min:"0",value:i.weeklyTargetHours,onChange:e=>o("weeklyTargetHours",Number(e.target.value))})]}),s.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[s.jsx("input",{type:"checkbox",checked:i.active,onChange:e=>o("active",e.target.checked)}),s.jsx("span",{children:"Active"})]}),s.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[s.jsx(a,{variant:"secondary",onClick:n,children:"Cancel"}),s.jsx(a,{onClick:function(){i.code&&i.title&&l(i)},children:"Save"})]})]})})}function p({events:e,subjects:t}){const l=e.filter(e=>"study"===e.kind||e.title.startsWith("Study")),n=l.reduce((e,s)=>e+(d(s.end)-d(s.start)),0),a=t.map(e=>({subject:e,mins:l.filter(s=>s.courseId===e.id).reduce((e,s)=>e+(d(s.end)-d(s.start)),0)}));return s.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-3 mb-2 shadow-sm text-sm flex items-center space-x-4 overflow-x-auto",children:[s.jsxs("div",{children:["Total study: ",(n/60).toFixed(1),"h"]}),a.map(e=>s.jsxs("div",{className:"flex items-center space-x-1",children:[s.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:e.subject.color}}),s.jsxs("span",{children:[e.subject.code,": ",(e.mins/60).toFixed(1),"h"]})]},e.subject.id))]})}function b(e,s){const[t,l]=s.split(":").map(Number),n=new Date(e);return n.setHours(t,l,0,0),n.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}function f(){const{courses:t,setCourses:l,events:r,setEvents:o}=n(),[h,f]=e.useState("all"),[g,k]=e.useState([]),[y,N]=e.useState({class:!0,study:!0}),[C,w]=e.useState({morning:!0,afternoon:!0,evening:!0}),[S,E]=e.useState(!1),[I,L]=e.useState(null),[T,D]=e.useState(!1),[F,A]=e.useState(null),[M,R]=e.useState(new Date),U=t.map(e=>({value:e.id,label:e.code}));const O=r.filter(e=>{const s=0===g.length||g.includes(e.courseId),t=e.kind||(e.title.startsWith("Study")?"study":"class");if(!y[t])return!1;const l=d(e.start);return!(!C.morning&&l<720)&&(!(!C.afternoon&&l>=720&&l<1020)&&(!(!C.evening&&l>=1020)&&s))});return s.jsxs("div",{className:"flex h-full",children:[s.jsx(u,{subjects:t,filter:h,setFilter:f,onAdd:()=>{L(null),E(!0)},onEdit:e=>{L(e),E(!0)},onDelete:e=>function(e){window.confirm("Delete subject and its sessions?")&&(l(t.filter(s=>s.id!==e)),o(r.filter(s=>s.courseId!==e)),k(s=>s.filter(s=>s!==e)))}(e),onExportCSV:()=>function(e){const s=e.map(e=>{var s,t,l;return[e.courseId||"",e.kind||"",e.day,e.start,e.end,e.location||"",e.notes||"",(null==(s=e.recur)?void 0:s.freq)||"",(null==(t=e.recur)?void 0:t.interval)||"",(null==(l=e.recur)?void 0:l.until)||""]}),t=[["subject","kind","day","start","end","location","notes","recur_freq","recur_interval","recur_until"].join(","),...s.map(e=>e.join(","))].join("\n"),l=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(l),a=document.createElement("a");a.href=n,a.download="schedule.csv",a.click(),URL.revokeObjectURL(n)}(r),onExportICS:()=>function(e){const s=c(new Date),t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//StudyFlex//EN"];e.forEach(e=>{const l=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].indexOf(e.day),n=i(s,l);t.push("BEGIN:VEVENT"),t.push(`UID:${e.id}`),t.push(`SUMMARY:${e.title}`),t.push(`DTSTART:${b(n,e.start)}`),t.push(`DTEND:${b(n,e.end)}`),e.location&&t.push(`LOCATION:${e.location}`),t.push("END:VEVENT")}),t.push("END:VCALENDAR");const l=new Blob([t.join("\n")],{type:"text/calendar"}),n=URL.createObjectURL(l),a=document.createElement("a");a.href=n,a.download="schedule.ics",a.click(),URL.revokeObjectURL(n)}(r),onSelect:e=>k([e])}),s.jsxs("div",{className:"flex-1 p-4 overflow-auto",children:[s.jsx(x,{week:M,onPrev:()=>R(i(M,-7)),onNext:()=>R(i(M,7)),onToday:()=>R(new Date),subjectFilter:g,setSubjectFilter:k,kindFilter:y,setKindFilter:N,timeFilter:C,setTimeFilter:w,subjectOptions:U}),s.jsx(p,{events:O,subjects:t}),s.jsx(m,{events:O,subjects:t}),s.jsx("div",{className:"mt-4",children:s.jsx(a,{onClick:()=>{A(null),D(!0)},children:"Add session"})})]}),S&&s.jsx(v,{initial:I,onSave:function(e){l(I?t.map(s=>s.id===I.id?{...I,...e}:s):[...t,{id:crypto.randomUUID(),...e}]),E(!1)},onClose:()=>E(!1)}),T&&s.jsx(j,{subjects:t,initial:F,onSave:function(e){if(F)o(r.map(s=>s.id===F.id?{...F,...e}:s));else{const s=t.find(s=>s.id===e.subjectId),l="study"===e.kind?`Study: ${s.code}`:`Class: ${s.code}`;o([...r,{id:crypto.randomUUID(),title:l,courseId:e.subjectId,day:e.day,start:e.start,end:e.end,kind:e.kind,location:e.location,notes:e.notes}])}D(!1)},onClose:()=>D(!1)})]})}export{f as default};
