import{g as e,j as s,u as t,R as r,L as n}from"./index-BcRcl4eo.js";import{B as o}from"./Button-6eMtmBLB.js";import{C as a}from"./Card-oX1d5raC.js";const c=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function i(e){const[s,t]=e.split(":").map(Number);return 60*s+t}function d(e){return`${String(Math.floor(e/60)).padStart(2,"0")}:${String(e%60).padStart(2,"0")}`}function l(e,s,t){const r=[];for(let n=e;n<s;n+=t)r.push(n);return r}function u(e,s){return i(e.start)<i(s.end)&&i(s.start)<i(e.end)}function f(e,s,t){return{day:e,start:s,end:t}}function m(e,s,t){const{prefs:r,nowISO:n,daySchedule:o}=t,a=function(e,s){if(!e.assessments||0===e.assessments.length)return 0;const t=new Date(s),r=e.assessments.map(e=>(new Date(e.deadlineISO)-t)/864e5),n=Math.min(...r);return Math.max(0,Math.min(1,1-n/14))}(s,n),c=function(e,s){const t=Math.floor(i(e.start)/60);return t>=7&&t<12?s.preferredTimes.morning?1:.5:t>=12&&t<17?s.preferredTimes.afternoon?1:.5:t>=17&&t<22&&s.preferredTimes.evening?1:0}(e,r),d=function(e){let s=(e.weeklyTargetHours||0)/6;return e.assessments&&e.assessments.some(e=>"high"===e.priority)&&(s+=.2),Math.min(1,s)}(s),l=function(e,s){let t=i(e.end)>i("20:30")?1:0;return s.some(s=>u(s,e)||s.end===e.start)&&(t+=.5),t}(e,o);return 3*a+2*c+2*d-1*l}function h({courses:e,fixedEvents:s,prefs:t,weekConfig:r}){const n=function(e,s,t){const r=[];for(const n of e.days){const o=s.filter(e=>e.day===n),a=60*e.startHour,c=60*e.endHour;for(const e of l(a,c-t,t)){const s={day:n,start:d(e),end:d(e+t)};o.some(e=>u(e,s))||r.push(s)}}return r}(r,s,t.sessionMinutes),o=[],a=(new Date).toISOString();for(const c of n)for(const s of e){if(s._remaining<=0)continue;const e=m(c,s,{prefs:t,nowISO:a,daySchedule:[]});o.push({score:e,slot:c,courseId:s.id})}return o.sort((e,s)=>s.score-e.score)}function x({courses:e,fixedEvents:s,prefs:t,weekConfig:r}){const n=Object.fromEntries(e.map(e=>[e.id,{...e,_remaining:e.weeklyTargetHours||0}])),o=function(e,s){const{prefs:t,courseMap:r}=s,n=[],o={Mon:[],Tue:[],Wed:[],Thu:[],Fri:[],Sat:[],Sun:[]},a={Mon:0,Tue:0,Wed:0,Thu:0,Fri:0,Sat:0,Sun:0};for(const c of e){const{slot:e,courseId:s}=c,i=e.day,d=r[s];d._remaining<=0||a[i]+t.sessionMinutes/60>t.dailyMaxHours||o[i].some(s=>u(s,e))||(n.push({slot:e,courseId:s}),o[i].push(e),a[i]+=t.sessionMinutes/60,d._remaining-=t.sessionMinutes/60)}return{schedule:n,usedByDay:o,dailyTotals:a}}(h({courses:Object.values(n),fixedEvents:s,prefs:t,weekConfig:r}),{prefs:t,courseMap:n});return function(e,s){return e.schedule.map(({slot:e,courseId:t})=>{const r=s[t];return{id:crypto.randomUUID(),title:`Study: ${r.code}`,day:e.day,start:e.start,end:e.end,courseId:t,color:r.color||"#3b82f6"}})}(o,n)}function p(){const{courses:s,events:t,prefs:r,setEvents:n}=e();return{generateSchedule:function({replace:e=!0}={}){const o=function(e){const s=[];return e.courses.forEach(e=>{(e.fixedSlots||[]).forEach(e=>s.push(f(e.day,e.start,e.end)))}),(e.events||[]).forEach(e=>{e.title.startsWith("Study: ")||s.push(f(e.day,e.start,e.end))}),s}({courses:s,events:t}),a=function(e){return{days:c,startHour:e.workingHours.start,endHour:e.workingHours.end}}(r),i=x({courses:s,fixedEvents:o,prefs:r,weekConfig:a});return n(s=>[...e?s.filter(e=>!e.title.startsWith("Study: ")):s,...i]),i.length}}}function g(){return s.jsxs("div",{className:"p-6 bg-surface border border-border rounded-lg",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-offset",children:"Progress Tracking"}),s.jsx("div",{className:"mt-4 flex items-center justify-center",children:s.jsx("p",{className:"text-sm text-text-muted",children:"No progress to show yet."})})]})}function j(){return s.jsxs("div",{className:"p-6 bg-surface border border-border rounded-lg",children:[s.jsx("h2",{className:"text-lg font-semibold text-text-offset",children:"Alerts"}),s.jsx("div",{className:"mt-4 flex items-center justify-center",children:s.jsx("p",{className:"text-sm text-text-muted",children:"No new alerts."})})]})}function y(){const c=t(),{events:i,courses:d}=e(),{generateSchedule:l}=p(),u=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],f=r.useMemo(()=>Object.fromEntries(d.map(e=>[e.id,e])),[d]),m=i.filter(e=>e.title&&e.title.startsWith("Study: ")),h=u.reduce((e,s)=>(e[s]=m.filter(e=>e.day===s),e),{}),x=m.length>0;return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h1",{className:"text-4xl font-semibold",children:"Dashboard"}),s.jsxs("div",{className:"space-x-2",children:[s.jsx(o,{onClick:()=>window.open("https://calendar.google.com/calendar/u/0/r","_blank"),children:"Sync with Google Calendar"}),s.jsx(o,{variant:"ghost",onClick:()=>c("/wizard"),children:"Generate Plan"}),s.jsx(o,{variant:"ghost",onClick:()=>l(),children:"Regenerate Schedule"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[s.jsx("div",{className:"md:col-span-2",children:x?s.jsxs(a,{className:"p-6",children:[s.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"Weekly Overview"}),s.jsx("div",{className:"grid grid-cols-7 gap-4 text-sm",children:u.map(e=>s.jsxs("div",{className:"space-y-2",children:[s.jsx("div",{className:"text-center font-medium",children:e}),h[e].map(e=>{var t;return s.jsx(n,{to:`/task/${e.id}`,children:s.jsxs("div",{className:"flex items-center space-x-2 rounded-xl border border-gray-200 p-2 hover:bg-gray-100 cursor-pointer",children:[s.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:e.color||"#3b82f6"}}),s.jsxs("div",{className:"truncate",children:[s.jsx("div",{className:"truncate text-sm font-medium",children:e.title}),(null==(t=f[e.courseId])?void 0:t.code)&&s.jsx("div",{className:"truncate text-xs text-gray-500",children:f[e.courseId].code}),s.jsxs("div",{className:"truncate text-xs text-gray-400",children:[e.start," - ",e.end]})]})]})},e.id)})]},e))})]}):s.jsxs(a,{className:"p-6 h-full flex flex-col items-center justify-center",children:[s.jsx("h2",{className:"text-xl font-semibold text-text-offset",children:"No events scheduled"}),s.jsx("p",{className:"mt-2 text-text-muted",children:'Click the "Generate Plan" button to create your study schedule.'})]})}),s.jsxs("div",{className:"space-y-8",children:[s.jsx(g,{}),s.jsx(j,{})]})]})]})}export{y as default};
//# sourceMappingURL=Dashboard-8lKCuVUO.js.map
