import{j as e,r as s,g as t}from"./index-BcRcl4eo.js";import{I as l}from"./Input-COPS-Y84.js";import{B as n}from"./Button-6eMtmBLB.js";import{w as a,a as c,f as i,b as r,t as o}from"./time-vicycg6B.js";function d({className:s="",...t}){return e.jsx("button",{className:`inline-flex h-10 w-10 items-center justify-center rounded-full text-gray-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500/40 ${s}`,...t})}function u({subjects:t,onAdd:a,onEdit:c,onDelete:i,onExportCSV:r,onExportICS:o,filter:u,setFilter:x,onSelect:h}){const[m,j]=s.useState(""),b=t.filter(e=>("all"===u||("active"===u?e.active:!e.active))&&(e.code.toLowerCase().includes(m.toLowerCase())||e.title.toLowerCase().includes(m.toLowerCase())));return e.jsxs("aside",{className:"w-64 bg-white border-r border-gray-200 flex flex-col flex-shrink-0",children:[e.jsxs("div",{className:"p-4 border-b",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Subjects"}),e.jsx(l,{placeholder:"Search subjects...",value:m,onChange:e=>j(e.target.value),className:"w-full"})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"flex bg-gray-100 rounded-md p-1",children:[{k:"all",label:"All"},{k:"active",label:"Active"},{k:"inactive",label:"Inactive"}].map(s=>e.jsx("button",{onClick:()=>x(s.k),className:"w-full text-center text-sm py-1.5 rounded-md transition-colors "+(u===s.k?"bg-white shadow-sm text-gray-800 font-medium":"text-gray-500 hover:bg-gray-200"),children:s.label},s.k))})}),e.jsx("div",{className:"flex-1 overflow-y-auto border-t",children:b.length>0?e.jsx("ul",{className:"divide-y",children:b.map(s=>e.jsxs("li",{onClick:()=>h(s.id),className:"p-4 cursor-pointer hover:bg-gray-50 group relative",children:[e.jsx("div",{className:"font-semibold text-gray-800",children:s.code}),e.jsx("div",{className:"text-sm text-gray-500",children:s.title}),e.jsxs("div",{className:"absolute top-2 right-2 flex items-center space-x-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(d,{size:"sm","aria-label":"edit subject",onClick:e=>{e.stopPropagation(),c(s)},children:e.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L14.732 3.732z"})})}),e.jsx(d,{size:"sm","aria-label":"delete subject",onClick:e=>{e.stopPropagation(),i(s.id)},children:e.jsx("svg",{className:"h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},s.id))}):e.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No subjects found."})}),e.jsxs("div",{className:"p-4 border-t space-y-2",children:[e.jsx(n,{onClick:a,className:"w-full",children:"Add Subject"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(n,{onClick:r,variant:"outline",children:"Export CSV"}),e.jsx(n,{onClick:o,variant:"outline",children:"Export ICS"})]})]})]})}function x({week:s,onPrev:t,onNext:l,onToday:r,subjectFilter:o,setSubjectFilter:d,kindFilter:u,setKindFilter:x,timeFilter:h,setTimeFilter:m,subjectOptions:j=[]}){const b=a(s),p=c(b,6),v=`${i(b,"MMM d")} - ${i(p,"MMM d")}`;return e.jsxs("div",{className:"flex flex-col space-y-2 md:flex-row md:items-center md:justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{onClick:t,children:"‹"}),e.jsx(n,{onClick:r,children:"Today"}),e.jsx(n,{onClick:l,children:"›"}),e.jsx("div",{className:"ml-4 font-semibold",children:v})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("select",{multiple:!0,value:o,onChange:e=>d(Array.from(e.target.selectedOptions).map(e=>e.value)),className:"border rounded p-1",children:j.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),e.jsxs("label",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"checkbox",checked:u.class,onChange:e=>x({...u,class:e.target.checked})}),e.jsx("span",{children:"Class"})]}),e.jsxs("label",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"checkbox",checked:u.study,onChange:e=>x({...u,study:e.target.checked})}),e.jsx("span",{children:"Study"})]}),e.jsxs("label",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"checkbox",checked:h.morning,onChange:e=>m({...h,morning:e.target.checked})}),e.jsx("span",{children:"Morning"})]}),e.jsxs("label",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"checkbox",checked:h.afternoon,onChange:e=>m({...h,afternoon:e.target.checked})}),e.jsx("span",{children:"Afternoon"})]}),e.jsxs("label",{className:"flex items-center space-x-1",children:[e.jsx("input",{type:"checkbox",checked:h.evening,onChange:e=>m({...h,evening:e.target.checked})}),e.jsx("span",{children:"Evening"})]}),e.jsx(n,{onClick:()=>window.print(),className:"ml-2",children:"Print"})]})]})}function h({event:s,subject:t,style:l}){var n;const a=(null==t?void 0:t.color)||"#3b82f6",c="study"===s.kind||(null==(n=s.title)?void 0:n.startsWith("Study:"));return e.jsx("div",{className:"absolute px-1 py-0.5 text-xs rounded overflow-hidden "+(c?"text-white":"border"),style:{backgroundColor:c?a:"white",borderColor:a,color:c?"white":"black",left:2,right:2,...l},children:c?`Study: ${(null==t?void 0:t.code)||""}`:`Class: ${(null==t?void 0:t.code)||""}`})}function m({events:s,subjects:t}){return e.jsx("div",{className:"grid grid-cols-7 h-[900px] relative",children:r.map((l,n)=>e.jsx("div",{className:"border-r border-b relative",children:s.filter(e=>e.day===l).map(s=>{const l=(o(s.start)-420)/900*100,n=(o(s.end)-o(s.start))/900*100,a=t.find(e=>e.id===s.courseId);return e.jsx(h,{event:s,subject:a,style:{top:`${l}%`,height:`${n}%`}},s.id)})},l))})}function j({subjects:t,onSave:a,onClose:c,initial:i}){var r;const[o,d]=s.useState(i||{subjectId:(null==(r=t[0])?void 0:r.id)||"",kind:"study",day:"Mon",start:"09:00",end:"10:00"});function u(e,s){d({...o,[e]:s})}return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white p-4 rounded w-80 space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Session"}),e.jsxs("label",{className:"block text-sm",children:["Subject",e.jsx("select",{value:o.subjectId,onChange:e=>u("subjectId",e.target.value),className:"w-full border rounded p-1",children:t.map(s=>e.jsx("option",{value:s.id,children:s.code},s.id))})]}),e.jsxs("label",{className:"block text-sm",children:["Kind",e.jsxs("select",{value:o.kind,onChange:e=>u("kind",e.target.value),className:"w-full border rounded p-1",children:[e.jsx("option",{value:"class",children:"Class"}),e.jsx("option",{value:"study",children:"Study"})]})]}),e.jsxs("label",{className:"block text-sm",children:["Day",e.jsx("select",{value:o.day,onChange:e=>u("day",e.target.value),className:"w-full border rounded p-1",children:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("label",{className:"block text-sm flex-1",children:["Start",e.jsx(l,{type:"time",value:o.start,onChange:e=>u("start",e.target.value)})]}),e.jsxs("label",{className:"block text-sm flex-1",children:["End",e.jsx(l,{type:"time",value:o.end,onChange:e=>u("end",e.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(n,{onClick:c,type:"button",variant:"secondary",children:"Cancel"}),e.jsx(n,{onClick:function(){a(o)},type:"button",children:"Save"})]})]})})}function b({onSave:t,onClose:a,initial:c}){const[i,r]=s.useState(c||{code:"",title:"",instructor:"",color:"#3b82f6",active:!0,weeklyTargetHours:3});function o(e,s){r({...i,[e]:s})}return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"bg-white p-4 rounded w-80 space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Subject"}),e.jsxs("label",{className:"block text-sm",children:["Code",e.jsx(l,{value:i.code,onChange:e=>o("code",e.target.value)})]}),e.jsxs("label",{className:"block text-sm",children:["Title",e.jsx(l,{value:i.title,onChange:e=>o("title",e.target.value)})]}),e.jsxs("label",{className:"block text-sm",children:["Instructor",e.jsx(l,{value:i.instructor,onChange:e=>o("instructor",e.target.value)})]}),e.jsxs("label",{className:"block text-sm",children:["Color",e.jsx(l,{type:"color",value:i.color,onChange:e=>o("color",e.target.value)})]}),e.jsxs("label",{className:"block text-sm",children:["Weekly Target Hours",e.jsx(l,{type:"number",min:"0",value:i.weeklyTargetHours,onChange:e=>o("weeklyTargetHours",Number(e.target.value))})]}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:i.active,onChange:e=>o("active",e.target.checked)}),e.jsx("span",{children:"Active"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsx(n,{variant:"secondary",onClick:a,children:"Cancel"}),e.jsx(n,{onClick:function(){i.code&&i.title&&t(i)},children:"Save"})]})]})})}function p({events:s,subjects:t}){const l=s.filter(e=>"study"===e.kind||e.title.startsWith("Study")),n=l.reduce((e,s)=>e+(o(s.end)-o(s.start)),0),a=t.map(e=>({subject:e,mins:l.filter(s=>s.courseId===e.id).reduce((e,s)=>e+(o(s.end)-o(s.start)),0)}));return e.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-3 mb-2 shadow-sm text-sm flex items-center space-x-4 overflow-x-auto",children:[e.jsxs("div",{children:["Total study: ",(n/60).toFixed(1),"h"]}),a.map(s=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-full",style:{backgroundColor:s.subject.color}}),e.jsxs("span",{children:[s.subject.code,": ",(s.mins/60).toFixed(1),"h"]})]},s.subject.id))]})}function v(e,s){const[t,l]=s.split(":").map(Number),n=new Date(e);return n.setHours(t,l,0,0),n.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z"}function f(){const{courses:l,setCourses:i,events:d,setEvents:h}=t(),[f,g]=s.useState("all"),[y,k]=s.useState([]),[N,C]=s.useState({class:!0,study:!0}),[w,S]=s.useState({morning:!0,afternoon:!0,evening:!0}),[E,I]=s.useState(!1),[L,T]=s.useState(null),[D,F]=s.useState(!1),[A,M]=s.useState(null),[R,U]=s.useState(new Date),$=l.map(e=>({value:e.id,label:e.code}));const O=d.filter(e=>{const s=0===y.length||y.includes(e.courseId),t=e.kind||(e.title.startsWith("Study")?"study":"class");if(!N[t])return!1;const l=o(e.start);return!(!w.morning&&l<720)&&(!(!w.afternoon&&l>=720&&l<1020)&&(!(!w.evening&&l>=1020)&&s))});return e.jsxs("div",{className:"flex h-full",children:[e.jsx(u,{subjects:l,filter:f,setFilter:g,onAdd:()=>{T(null),I(!0)},onEdit:e=>{T(e),I(!0)},onDelete:e=>function(e){window.confirm("Delete subject and its sessions?")&&(i(l.filter(s=>s.id!==e)),h(d.filter(s=>s.courseId!==e)),k(s=>s.filter(s=>s!==e)))}(e),onExportCSV:()=>function(e){const s=e.map(e=>{var s,t,l;return[e.courseId||"",e.kind||"",e.day,e.start,e.end,e.location||"",e.notes||"",(null==(s=e.recur)?void 0:s.freq)||"",(null==(t=e.recur)?void 0:t.interval)||"",(null==(l=e.recur)?void 0:l.until)||""]}),t=[["subject","kind","day","start","end","location","notes","recur_freq","recur_interval","recur_until"].join(","),...s.map(e=>e.join(","))].join("\n"),l=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(l),a=document.createElement("a");a.href=n,a.download="schedule.csv",a.click(),URL.revokeObjectURL(n)}(d),onExportICS:()=>function(e){const s=a(new Date),t=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//StudyFlex//EN"];e.forEach(e=>{const l=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].indexOf(e.day),n=c(s,l);t.push("BEGIN:VEVENT"),t.push(`UID:${e.id}`),t.push(`SUMMARY:${e.title}`),t.push(`DTSTART:${v(n,e.start)}`),t.push(`DTEND:${v(n,e.end)}`),e.location&&t.push(`LOCATION:${e.location}`),t.push("END:VEVENT")}),t.push("END:VCALENDAR");const l=new Blob([t.join("\n")],{type:"text/calendar"}),n=URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.download="schedule.ics",i.click(),URL.revokeObjectURL(n)}(d),onSelect:e=>k([e])}),e.jsxs("div",{className:"flex-1 p-4 overflow-auto",children:[e.jsx(x,{week:R,onPrev:()=>U(c(R,-7)),onNext:()=>U(c(R,7)),onToday:()=>U(new Date),subjectFilter:y,setSubjectFilter:k,kindFilter:N,setKindFilter:C,timeFilter:w,setTimeFilter:S,subjectOptions:$}),e.jsx(p,{events:O,subjects:l}),e.jsx("div",{className:"grid grid-cols-7",children:r.map(s=>e.jsx("div",{className:"text-center font-semibold text-gray-600 p-2 border-b",children:s},s))}),e.jsx(m,{events:O,subjects:l}),e.jsx("div",{className:"mt-4",children:e.jsx(n,{onClick:()=>{M(null),F(!0)},children:"Add session"})})]}),E&&e.jsx(b,{initial:L,onSave:function(e){i(L?l.map(s=>s.id===L.id?{...L,...e}:s):[...l,{id:crypto.randomUUID(),...e}]),I(!1)},onClose:()=>I(!1)}),D&&e.jsx(j,{subjects:l,initial:A,onSave:function(e){if(A)h(d.map(s=>s.id===A.id?{...A,...e}:s));else{const s=l.find(s=>s.id===e.subjectId),t="study"===e.kind?`Study: ${s.code}`:`Class: ${s.code}`;h([...d,{id:crypto.randomUUID(),title:t,courseId:e.subjectId,day:e.day,start:e.start,end:e.end,kind:e.kind,location:e.location,notes:e.notes}])}F(!1)},onClose:()=>F(!1)})]})}export{f as default};
//# sourceMappingURL=Schedule-D24r1FNR.js.map
